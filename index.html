<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>IPTV Player Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{background:#000;color:#fff;font-family:system-ui;overflow:hidden}
        #player{width:100vw;height:100vh;background:#000}
        #overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:999;display:flex;align-items:center;justify-content:center;flex-direction:column;text-align:center;padding:40px;display:flex}
        #controls{position:fixed;bottom:0;left:0;right:0;background:rgba(0,0,0,0.98);backdrop-filter:blur(20px);padding:20px;box-shadow:0-10px 40px rgba(0,230,118,0.5)}
        button{background:#ff4081;color:#fff;border:0;padding:12px 20px;margin:4px;border-radius:25px;font-size:15px;font-weight:700;min-width:90px;box-shadow:0 3px 15px rgba(255,64,129,0.4)}
        button:active{transform:scale(.95)}
        select{background:rgba(255,255,255,.15);color:#fff;padding:12px;border-radius:12px;width:100%;margin:5px 0;font-size:16px;border:1px solid rgba(255,255,255,.3)}
        #channels-container{display:flex;gap:10px;margin:10px 0}
        #channels{flex:1;max-height:200px;overflow:auto;background:rgba(255,255,255,.08);border-radius:12px;padding:10px}
        .channel{padding:10px 8px;font-size:14px;border-radius:8px;cursor:pointer;transition:all .2s;margin-bottom:4px;border-left:3px solid transparent}
        .channel:hover,.channel.active{background:rgba(255,64,129,.8);border-left-color:#ff4081}
        #status{position:fixed;top:15px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.9);padding:10px 20px;border-radius:20px;font-size:14px;white-space:nowrap}
        #debug{position:fixed;top:60px;right:15px;background:rgba(0,0,0,.8);padding:8px 12px;border-radius:12px;font-size:12px;max-width:200px}
        #volume{width:120px;height:5px;margin:5px}
        .loading{animation:pulse 1.5s infinite}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
    </style>
</head>
<body>
    <div id="overlay">
        <div style="font-size:36px;margin-bottom:15px;">üì∫</div>
        <div style="font-size:22px;margin-bottom:25px;">IPTV Player Ready</div>
        <button onclick="startPlayer()" style="font-size:18px;padding:18px 40px;background:#00e676;box-shadow:0 5px 25px rgba(0,230,118,.5)">‚ñ∂Ô∏è START</button>
        <div style="margin-top:25px;font-size:13px;color:#ccc;max-width:300px;line-height:1.4">
            Touch screen to unlock audio & load channels
        </div>
    </div>

    <div id="status" class="loading">Click Start ‚ñ∂Ô∏è</div>
    <div id="debug"></div>
    
    <video id="player" preload="metadata" playsinline webkit-playsinline x5-playsinline style="width:100vw;height:100vh;object-fit:contain"></video>

    <div id="controls" style="display:none">
        <select id="playlist">
            <option value="https://iptv-eum.pages.dev/Free tv.m3u">üî• All Channels (Full)</option>
        </select>
        <div id="channels-container">
            <div id="channels">Click START to load channels</div>
            <div style="width:120px">
                <div>Vol</div>
                <input type="range" id="volume" min="0" max="1" step="0.05" value="0.8">
                <button id="mute" onclick="toggleMute()" style="width:100%;background:#00e676;margin:5px 0 0 0">üîä</button>
            </div>
        </div>
        <div style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
            <button onclick="prev()">‚èÆÔ∏è Prev</button>
            <button onclick="playPause()" id="playbtn">‚è∏Ô∏è</button>
            <button onclick="next()">Next ‚ñ∂Ô∏è</button>
        </div>
    </div>

    <script>
        const video = document.getElementById('player');
        const hls = new Hls({enableWorker:false,lowLatencyMode:true,maxBufferLength:30});
        let channels = [], currentIndex = 0, isPlaying = false;
        
        video.volume = 0.8;
        let hasInteracted = false;

        function log(msg) {
            document.getElementById('debug').innerHTML = msg;
            console.log(msg);
        }

        function startPlayer() {
            hasInteracted = true;
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('controls').style.display = 'block';
            video.muted = false;
            video.volume = 1.0;
            loadM3U();
        }

        // üî• MULTIPLE M3U LOADERS (·Äê·ÄÖ·Ä∫·ÄÅ·ÄØ fail ·Äõ·ÄÑ·Ä∫ ·Äî·Ä±·Ä¨·ÄÄ·Ä∫·Äê·ÄÖ·Ä∫·ÄÅ·ÄØ)
        async function loadM3U() {
            const urls = [
                document.getElementById('playlist').value,
                'https://iptv-org.github.io/iptv/index.m3u',
                'https://raw.githubusercontent.com/iptv-org/iptv/master/channels/us.m3u'
            ];
            
            for(let url of urls) {
                try {
                    log(`Loading: ${url}`);
                    const m3u = await fetchM3U(url);
                    if(m3u) {
                        parseM3U(m3u);
                        log(`‚úÖ ${channels.length} channels loaded!`);
                        play(0);
                        return;
                    }
                } catch(e) {
                    log(`‚ùå ${url} failed`);
                }
            }
            log('‚ùå All playlists failed');
        }

        // üî• CORS-FREE M3U FETCH
        async function fetchM3U(url) {
            const proxies = [
                `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`,
                `https://corsproxy.io/?${encodeURIComponent(url)}`,
                `https://thingproxy.freeboard.io/fetch/${encodeURIComponent(url)}`
            ];
            
            for(let proxy of proxies) {
                try {
                    const res = await fetch(proxy, {cache: 'no-cache'});
                    if(res.ok) {
                        const data = await res.text();
                        if(data.includes('#EXTINF')) return data;
                    }
                } catch(e) {}
            }
            return null;
        }

        function parseM3U(m3u) {
            channels = [];
            const lines = m3u.split('\n');
            let current = null;
            
            for(let line of lines) {
                line = line.trim();
                if(line.startsWith('#EXTINF:')) {
                    const name = line.split(',').pop()?.replace(/[\n\r]/g,'') || 'Channel';
                    current = {name: name.substring(0,50)};
                } else if(line.startsWith('http') && current) {
                    current.url = line;
                    channels.push(current);
                    current = null;
                }
            }
            
            document.getElementById('status').textContent = `${channels.length} channels ‚úì`;
            showChannels();
        }

        function showChannels() {
            const container = document.getElementById('channels');
            if(channels.length === 0) {
                container.innerHTML = '<div style="text-align:center;padding:20px;color:#666">No channels</div>';
                return;
            }
            container.innerHTML = channels.slice(0,30).map((ch,i)=>`
                <div class="channel ${i===currentIndex?'active':''}" onclick="play(${i})">
                    ${ch.name}
                </div>
            `).join('');
        }

        async function play(index) {
            if(index >= channels.length) return;
            currentIndex = index;
            const channel = channels[index];
            showChannels();
            document.getElementById('status').textContent = channel.name;
            
            if(hasInteracted) video.muted = false;
            
            try {
                if(channel.url.includes('.m3u8') || channel.url.includes('.ts')) {
                    hls.destroy();
                    hls.loadSource(channel.url);
                    hls.attachMedia(video);
                } else {
                    video.src = channel.url;
                }
                await video.play();
                isPlaying = true;
                document.getElementById('playbtn').textContent = '‚è∏Ô∏è';
            } catch(e) {
                document.getElementById('status').textContent = 'Stream failed';
            }
        }

        function playPause() {
            if(isPlaying) {
                video.pause();
                isPlaying = false;
                document.getElementById('playbtn').textContent = '‚ñ∂Ô∏è';
            } else {
                video.play();
                isPlaying = true;
                document.getElementById('playbtn').textContent = '‚è∏Ô∏è';
            }
        }

        function toggleMute() {
            video.muted = !video.muted;
            document.getElementById('mute').textContent = video.muted ? 'üîá' : 'üîä';
        }

        function prev() { play(Math.max(0, currentIndex-1)); }
        function next() { play((currentIndex+1) % Math.max(1, channels.length)); }

        // Controls
        document.addEventListener('keydown', e=>{
            if(!hasInteracted) return;
            e.preventDefault();
            if(e.code==='ArrowLeft') prev();
            if(e.code==='ArrowRight') next();
            if(e.code==='Space') playPause();
        });

        video.addEventListener('ended', ()=>next());
    </script>
</body>
</html>
