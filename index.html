<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV Live Player</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üì∫</text></svg>">
    <style>
        :root{--bg:#000;--accent:#ff4081;--card:rgba(255,255,255,.08)}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:system-ui, -apple-system, sans-serif;background:var(--bg);color:#fff;overflow:hidden;touch-action:manipulation}
        #player{width:100vw;height:100vh;background:var(--bg);object-fit:contain}
        #ui{position:fixed;inset:0;pointer-events:none;z-index:10}
        #controls{bottom:20px;left:20px;right:20px;background:var(--card);backdrop-filter:blur(20px);border-radius:20px;padding:25px;pointer-events:all;box-shadow:0-20px 40px rgba(0,0,0,.5);border:1px solid rgba(255,255,255,.1)}
        h1{font-size:28px;margin-bottom:15px;text-align:center;background:linear-gradient(45deg,var(--accent),#00e676);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        select{width:100%;padding:15px;margin:10px 0;border-radius:15px;border:1px solid rgba(255,255,255,.3);background:rgba(255,255,255,.1);color:#fff;font-size:16px}
        #channels{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px;max-height:250px;overflow:auto;margin:15px 0;padding:15px;background:var(--card);border-radius:15px}
        .channel{padding:15px;border-radius:12px;cursor:pointer;transition:all .3s;font-size:14px;text-align:center;border:1px solid transparent}
        .channel:hover,.channel.active{background:var(--accent);border-color:#fff;transform:translateY(-2px);box-shadow:0 5px 20px rgba(255,64,129,.4)}
        .btns{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-top:15px}
        button{padding:15px 10px;border:0;border-radius:15px;font-size:16px;font-weight:700;cursor:pointer;transition:all .2s;background:var(--accent);color:#fff;box-shadow:0 4px 15px rgba(255,64,129,.3)}
        button:active{transform:scale(.95)}
        button.secondary{background:#666;box-shadow:0 4px 15px rgba(0,0,0,.3)}
        button.play-pause{background:#00e676 !important;box-shadow:0 4px 15px rgba(0,230,118,.4)}
        #status{position:fixed;top:20px;left:50%;transform:translate(-50%);background:rgba(0,0,0,.9);padding:12px 24px;border-radius:25px;font-weight:500}
        #volume{width:100%;height:6px;margin:10px 0;background:rgba(255,255,255,.2);border-radius:3px;accent-color:var(--accent)}
        .hidden{display:none}
        @media (max-width:600px){#channels{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <video id="video" autoplay playsinline muted preload="metadata"></video>
    
    <div id="ui">
        <div id="status">Loading player...</div>
        <div id="controls">
            <h1>üì∫ IPTV Live</h1>
            
            <select id="playlist">
                <option value="channels.m3u">üî• Your Channels</option>
            </select>
            
            <div id="channel-list">Click Load to see channels</div>
            
            <input type="range" id="volume" min="0" max="1" step="0.05" value="0.7">
            
            <div class="btns">
                <button onclick="previousChannel()" class="secondary">‚èÆÔ∏è Prev</button>
                <button onclick="togglePlay()" class="play-pause" id="playBtn">‚ñ∂Ô∏è</button>
                <button onclick="nextChannel()">Next ‚ñ∂Ô∏è</button>
            </div>
            
            <button onclick="toggleMute()" class="secondary" id="muteBtn" style="width:100%;margin-top:10px">üîä Unmute</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        class IPTVPlayer {
            constructor() {
                this.video = document.getElementById('video');
                this.hls = null;
                this.channels = [];
                this.currentIndex = 0;
                this.isPlaying = false;
                this.hasInteracted = false;
                
                this.init();
            }
            
            async init() {
                // Audio/Video setup
                this.video.volume = 0.7;
                this.video.addEventListener('loadedmetadata', () => {
                    document.getElementById('status').textContent = 'Ready to play!';
                });
                
                // User interaction unlock
                ['click', 'touchstart'].forEach(event => {
                    document.addEventListener(event, () => {
                        if(!this.hasInteracted) {
                            this.hasInteracted = true;
                            this.video.muted = false;
                            document.getElementById('muteBtn').textContent = 'üîä';
                        }
                    }, {once: true});
                });
                
                await this.loadPlaylist();
            }
            
            async loadPlaylist() {
                document.getElementById('status').textContent = 'Loading channels...';
                
                try {
                    const playlistUrl = document.getElementById('playlist').value;
                    const response = await fetch(playlistUrl);
                    const m3uContent = await response.text();
                    
                    this.parseM3U(m3uContent);
                    this.updateChannelList();
                    document.getElementById('status').textContent = `${this.channels.length} channels loaded!`;
                    
                } catch (error) {
                    document.getElementById('status').textContent = 'Failed to load playlist';
                    console.error('Playlist error:', error);
                }
            }
            
            parseM3U(m3uContent) {
                this.channels = [];
                const lines = m3uContent.split('\n');
                let currentChannel = null;
                
                for (let line of lines) {
                    line = line.trim();
                    if (line.startsWith('#EXTINF:')) {
                        const nameMatch = line.match(/,(.+)$/);
                        currentChannel = {
                            name: nameMatch ? nameMatch[1].trim() : 'Unknown Channel',
                            url: ''
                        };
                    } else if (line.startsWith('http') && currentChannel) {
                        currentChannel.url = line;
                        this.channels.push(currentChannel);
                        currentChannel = null;
                    }
                }
            }
            
            updateChannelList() {
                const container = document.getElementById('channel-list');
                container.innerHTML = this.channels.slice(0, 20).map((channel, index) => `
                    <div class="channel ${index === this.currentIndex ? 'active' : ''}" 
                         onclick="player.playChannel(${index})">
                        ${channel.name}
                    </div>
                `).join('');
            }
            
            async playChannel(index) {
                if (index >= this.channels.length) return;
                
                this.currentIndex = index;
                const channel = this.channels[index];
                
                document.getElementById('status').textContent = `Playing: ${channel.name}`;
                this.updateChannelList();
                
                try {
                    // Destroy previous HLS instance
                    if (this.hls) {
                        this.hls.destroy();
                    }
                    
                    if (Hls.isSupported() && channel.url.includes('.m3u8')) {
                        this.hls = new Hls({
                            enableWorker: false,
                            lowLatencyMode: true,
                            backBufferLength: 0
                        });
                        this.hls.loadSource(channel.url);
                        this.hls.attachMedia(this.video);
                    } else {
                        this.video.src = channel.url;
                    }
                    
                    await this.video.play();
                    this.isPlaying = true;
                    document.getElementById('playBtn').textContent = '‚è∏Ô∏è';
                    
                } catch (error) {
                    document.getElementById('status').textContent = 'Stream failed';
                }
            }
            
            nextChannel() {
                const nextIndex = (this.currentIndex + 1) % this.channels.length;
                this.playChannel(nextIndex);
            }
            
            previousChannel() {
                const prevIndex = this.currentIndex === 0 ? 
                    this.channels.length - 1 : this.currentIndex - 1;
                this.playChannel(prevIndex);
            }
            
            togglePlay() {
                if (this.isPlaying) {
                    this.video.pause();
                    this.isPlaying = false;
                    document.getElementById('playBtn').textContent = '‚ñ∂Ô∏è';
                } else {
                    this.video.play();
                    this.isPlaying = true;
                    document.getElementById('playBtn').textContent = '‚è∏Ô∏è';
                }
            }
            
            toggleMute() {
                this.video.muted = !this.video.muted;
                document.getElementById('muteBtn').textContent = 
                    this.video.muted ? 'üîá' : 'üîä';
            }
        }
        
        // Global player instance
        const player = new IPTVPlayer();
        
        // Global functions for onclick handlers
        window.playChannel = (index) => player.playChannel(index);
        window.nextChannel = () => player.nextChannel();
        window.previousChannel = () => player.previousChannel();
        window.togglePlay = () => player.togglePlay();
        window.toggleMute = () => player.toggleMute();
    </script>
</body>
</html>
